<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-md mx-auto p-4">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-6 mb-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold">üìö Vocabulary Manager</h1>
                    <p class="text-sm opacity-90">Qu·∫£n l√Ω t·ª´ v·ª±ng c·ªßa b·∫°n</p>
                </div>
                <a href="/manage.html" class="bg-white/20 px-4 py-2 rounded-lg hover:bg-white/30 text-sm">
                    üìñ Qu·∫£n l√Ω t·ª´
                </a>
            </div>
        </div>

        <!-- Status Alert -->
        <div id="alert" class="hidden mb-4 p-4 rounded-lg"></div>

        <!-- Add Word Section -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <h2 class="text-lg font-semibold mb-3">‚ûï Th√™m t·ª´</h2>
            <input type="text" id="wordInput" placeholder="Nh·∫≠p t·ª´ ti·∫øng Anh"
                   class="w-full px-4 py-2 border rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button onclick="addWord()"
                    class="w-full bg-blue-600 text-white py-2 rounded-lg font-medium hover:bg-blue-700">
                Th√™m v√†o queue
            </button>
        </div>

        <!-- Queue Section -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-lg font-semibold">üìù H√†ng ƒë·ª£i (<span id="queueCount">0</span>)</h2>
                <button onclick="loadQueue()" class="text-blue-600 text-sm">üîÑ Refresh</button>
            </div>
            <div id="queueList" class="space-y-2 mb-3 max-h-60 overflow-y-auto"></div>
            <button onclick="generateCollocations()" id="genBtn"
                    class="w-full bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 disabled:bg-gray-400">
                ü§ñ Generate Collocations
            </button>
        </div>

        <!-- Actions -->
        <div class="grid grid-cols-2 gap-3 mb-4">
            <button onclick="exportCSV()"
                    class="bg-purple-600 text-white py-2 rounded-lg font-medium hover:bg-purple-700">
                üì• Export CSV
            </button>
            <button onclick="deleteAll()"
                    class="bg-red-600 text-white py-2 rounded-lg font-medium hover:bg-red-700">
                üóëÔ∏è X√≥a t·∫•t c·∫£
            </button>
        </div>

        <!-- Settings Section -->
        <div class="bg-white rounded-lg shadow p-4">
            <h2 class="text-lg font-semibold mb-3">‚öôÔ∏è C√†i ƒë·∫∑t</h2>
            <label class="block text-sm font-medium mb-2">Google AI API Key:</label>
            <input type="password" id="apiKeyInput" placeholder="AIza..."
                   class="w-full px-4 py-2 border rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button onclick="saveApiKey()"
                    class="w-full bg-gray-700 text-white py-2 rounded-lg font-medium hover:bg-gray-800">
                üíæ L∆∞u API Key
            </button>
            <p class="text-xs text-gray-500 mt-2">
                L·∫•y API key t·ª´ <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600">Google AI Studio</a>
            </p>
        </div>
    </div>

    <script>
        let queue = [];
        const API_BASE = '';

        // Show alert
        function showAlert(message, type = 'info') {
            const alert = document.getElementById('alert');
            const colors = {
                success: 'bg-green-100 text-green-800 border-green-300',
                error: 'bg-red-100 text-red-800 border-red-300',
                info: 'bg-blue-100 text-blue-800 border-blue-300'
            };
            alert.className = `p-4 rounded-lg border ${colors[type] || colors.info}`;
            alert.textContent = message;
            alert.classList.remove('hidden');
            setTimeout(() => alert.classList.add('hidden'), 3000);
        }

        // Add word to queue
        async function addWord() {
            const word = document.getElementById('wordInput').value.trim();
            if (!word) return showAlert('Vui l√≤ng nh·∫≠p t·ª´', 'error');

            if (!/^[a-zA-Z\s-]+$/.test(word)) {
                return showAlert('Ch·ªâ nh·∫≠p ch·ªØ ti·∫øng Anh', 'error');
            }

            // Check if exists
            try {
                const res = await fetch(`${API_BASE}/api/check-word`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ word })
                });
                const data = await res.json();
                if (data.exists) {
                    return showAlert('T·ª´ ƒë√£ t·ªìn t·∫°i trong database', 'error');
                }
            } catch (err) {
                console.error(err);
            }

            // Add to queue
            if (!queue.includes(word)) {
                queue.push(word);
                document.getElementById('wordInput').value = '';
                loadQueue();
                showAlert(`ƒê√£ th√™m "${word}"`, 'success');
            } else {
                showAlert('T·ª´ ƒë√£ c√≥ trong queue', 'error');
            }
        }

        // Load queue
        function loadQueue() {
            const list = document.getElementById('queueList');
            const count = document.getElementById('queueCount');
            const genBtn = document.getElementById('genBtn');

            count.textContent = queue.length;
            genBtn.disabled = queue.length === 0;

            if (queue.length === 0) {
                list.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">Ch∆∞a c√≥ t·ª´ n√†o</p>';
                return;
            }

            list.innerHTML = queue.map((word, idx) => `
                <div class="flex justify-between items-center bg-gray-50 p-3 rounded">
                    <span class="font-medium">${word}</span>
                    <button onclick="removeWord(${idx})" class="text-red-600 hover:text-red-800">‚úï</button>
                </div>
            `).join('');
        }

        // Remove word
        function removeWord(idx) {
            queue.splice(idx, 1);
            loadQueue();
        }

        // Generate collocations
        async function generateCollocations() {
            if (queue.length === 0) return;

            const genBtn = document.getElementById('genBtn');
            genBtn.disabled = true;
            genBtn.textContent = '‚è≥ ƒêang x·ª≠ l√Ω...';

            try {
                const res = await fetch(`${API_BASE}/api/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ words: queue })
                });

                const data = await res.json();
                if (data.status === 'success') {
                    showAlert(`ƒê√£ t·∫°o ${data.count} collocations!`, 'success');
                    queue = [];
                    loadQueue();
                } else {
                    showAlert('L·ªói: ' + data.message, 'error');
                }
            } catch (err) {
                showAlert('L·ªói k·∫øt n·ªëi: ' + err.message, 'error');
            } finally {
                genBtn.disabled = false;
                genBtn.textContent = 'ü§ñ Generate Collocations';
            }
        }

        // Save API key
        async function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) return showAlert('Vui l√≤ng nh·∫≠p API key', 'error');

            if (!apiKey.startsWith('AIza')) {
                return showAlert('API key ph·∫£i b·∫Øt ƒë·∫ßu v·ªõi "AIza"', 'error');
            }

            try {
                const res = await fetch(`${API_BASE}/api/save-apikey`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey })
                });

                const data = await res.json();
                if (data.status === 'success') {
                    showAlert('ƒê√£ l∆∞u API key!', 'success');
                    document.getElementById('apiKeyInput').value = '';
                } else {
                    showAlert('L·ªói: ' + data.message, 'error');
                }
            } catch (err) {
                showAlert('L·ªói k·∫øt n·ªëi: ' + err.message, 'error');
            }
        }

        // Export CSV
        async function exportCSV() {
            try {
                window.location.href = `${API_BASE}/api/export-csv`;
                showAlert('ƒêang t·∫£i CSV...', 'info');
            } catch (err) {
                showAlert('L·ªói: ' + err.message, 'error');
            }
        }

        // Delete all
        async function deleteAll() {
            if (!confirm('X√≥a T·∫§T C·∫¢ d·ªØ li·ªáu? Kh√¥ng th·ªÉ ho√†n t√°c!')) return;

            try {
                const res = await fetch(`${API_BASE}/api/delete-all`, { method: 'POST' });
                const data = await res.json();
                if (data.status === 'success') {
                    showAlert(`ƒê√£ x√≥a ${data.deletedCount} collocations`, 'success');
                } else {
                    showAlert('L·ªói: ' + data.message, 'error');
                }
            } catch (err) {
                showAlert('L·ªói: ' + err.message, 'error');
            }
        }

        // Init
        loadQueue();
    </script>
</body>
</html>
